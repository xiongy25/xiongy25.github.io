# ESP32 AS5600 磁编码器读取项目

这是一个使用ESP32通过I2C接口读取AS5600磁编码器数据的项目。AS5600是一个12位的磁性角度编码器，可以精确测量0-360度的角度。

## 硬件要求

- ESP32开发板
- AS5600磁编码器模块
- 杜邦线（母对母）4根
- 磁铁（直径4-6mm，高度2.5mm的N35或N52钕磁铁）
- USB数据线（用于连接ESP32和电脑）

## 详细操作步骤

### 1. 硬件连接

将AS5600模块与ESP32按照下表连接：

| AS5600引脚 | ESP32引脚 | 线色建议 | 说明 |
|------------|-----------|----------|------|
| VDD        | 3.3V      | 红色     | 电源 |
| GND        | GND       | 黑色     | 地   |
| SDA        | GPIO21    | 黄色     | I2C数据线 |
| SCL        | GPIO22    | 白色     | I2C时钟线 |

注意事项：
- 确保所有连接牢固，没有虚接
- AS5600模块上方放置磁铁，建议距离2-3mm
- 磁铁正极朝上（一般磁铁的N极为正极）

### 2. 软件环境配置

1. 安装VSCode
   - 访问 https://code.visualstudio.com/ 下载并安装VSCode

2. 安装PlatformIO
   - 打开VSCode
   - 点击左侧扩展图标（或按Ctrl+Shift+X）
   - 搜索"PlatformIO"并安装
   - 等待安装完成后重启VSCode

3. 创建项目
   - 点击PlatformIO图标（左侧边栏蚂蚁图标）
   - 点击"New Project"
   - 项目名称自定义
   - Board选择"Espressif ESP32 Dev Module"
   - Framework选择"Arduino"
   - 选择项目存储位置
   - 点击"Finish"等待项目创建完成

### 3. 代码部署

1. 替换代码
   - 打开项目文件夹中的src/main.cpp
   - 删除原有代码
   - 复制本项目提供的main.cpp中的代码
   - 保存文件

2. 编译和上传
   - 点击PlatformIO工具栏中的"Build"图标（√）编译代码
   - 将ESP32通过USB线连接到电脑
   - 点击"Upload"图标（→）上传代码
   - 等待上传完成（底部状态栏显示success）

## Python可视化程序

项目包含一个Python程序（angle_visualizer.py），用于实时显示AS5600的角度数据。

### 1. 环境要求

- Python 3.7或更高版本
- 必需的Python库：
  ```bash
  pip install pyserial matplotlib numpy
  ```

### 2. 可视化程序功能

- 实时显示当前角度值
- 圆形表盘动态显示角度
- 角度随时间变化的曲线图
- 自动记录最近100个数据点
- 支持自动检测可用串口

### 3. 使用方法

1. 运行程序
   ```bash
   python angle_visualizer.py
   ```

2. 选择串口
   - 程序启动时会显示所有可用的COM口
   - 直接回车使用默认的COM4
   - 或输入其他可用的COM口号

3. 查看数据
   - 左侧圆形表盘显示当前角度
   - 右侧曲线图显示角度变化趋势
   - 顶部显示具体角度值

4. 退出程序
   - 按Ctrl+C退出
   - 或直接关闭窗口

### 4. 注意事项

- 确保ESP32已经正确连接并运行
- 确保选择了正确的串口
- 如果显示中文乱码，检查系统是否安装了中文字体
- 程序会自动处理串口断开等异常情况

## 常见问题解决

1. 找不到COM口
   - 检查USB连接
   - 安装CP210x驱动（ESP32常用USB转串口芯片）
   - 尝试更换USB线或USB接口

2. 上传失败
   - 按住ESP32的BOOT按钮，点击上传
   - 松开BOOT按钮，等待上传完成
   - 如果仍然失败，按一下EN（RST）按钮重置

3. 无法读取数据
   - 检查接线是否正确
   - 确认磁铁位置是否正确
   - 用万用表测量AS5600的供电电压是否为3.3V
   - 检查I2C地址是否正确（默认0x36）

4. 数据不稳定
   - 检查磁铁是否正确放置
   - 确保周围没有强磁场干扰
   - 检查接线是否牢固
   - 尝试调整磁铁与传感器的距离

5. 可视化程序问题
   - 确保已安装所有必需的Python库
   - 检查串口是否被其他程序占用
   - 如果显示卡顿，可以调整更新频率
   - 如果曲线显示异常，可以调整显示范围

## 技术支持

如果遇到问题：
1. 检查接线和磁铁放置
2. 查看串口输出的错误信息
3. 使用万用表测量电压
4. 通过项目Issues反馈问题

## 注意事项

- 避免带电插拔接线
- 注意静电防护
- 定期检查磁铁位置
- 避免在强磁场环境使用
- 保持模块清洁干燥
